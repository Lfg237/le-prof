<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Site √©ducatif interactif</title>
<style>
body {font-family: Arial,sans-serif; margin:0; padding:0; text-align:center; color:#fff;
background: linear-gradient(270deg, #4a90e2, #9013fe, #50e3c2, #f5a623); background-size:400% 400%; animation: gradientBG 15s ease infinite;}
@keyframes gradientBG {0%{background-position:0% 50%;}50%{background-position:100% 50%;}100%{background-position:0% 50%;}}
header{background:rgba(0,0,0,0.6); padding:20px; font-size:1.5em; font-weight:bold;}
.user-id, .score-box, .quiz-box, .ia-box{margin:20px auto; padding:15px; background:rgba(0,0,0,0.5); border-radius:12px; width:80%; max-width:500px;}
button{padding:10px 15px; margin:5px; border:none; border-radius:8px; background:#50e3c2; cursor:pointer; font-size:1em;}
button:hover{background:#4ad0b4;}
#answers button{display:block; width:100%; margin:8px 0;}
textarea{width:90%; height:80px; border-radius:8px; padding:8px; border:none; font-size:1em;}
#iaResponse{margin-top:10px; text-align:left; background:rgba(255,255,255,0.1); padding:10px; border-radius:8px;}
label{margin-right:10px;}
select{margin:5px; padding:5px 10px;}
</style>
</head>
<body>
<header id="title">üåç Site √©ducatif interactif</header>

<div class="user-id">
<span id="userIdLabel">ID Utilisateur :</span> <span id="userId"></span>
<br>
<button onclick="clearHistory()">üóëÔ∏è Vider l‚Äôhistorique</button>
</div>

<div class="score-box">
<b id="scoreLabel">Score :</b> <span id="score">0</span>
</div>

<div class="quiz-box">
<h3 id="question">Clique sur une r√©ponse pour commencer</h3>
<div id="answers"></div>
<br>
<label id="levelLabel">Niveau :</label>
<select id="levelSelect">
<option>CM1</option><option>CM2</option><option>6√®me</option><option>5√®me</option><option>4√®me</option><option>3√®me</option><option>2nde</option><option>1√®re</option><option>Terminale</option>
</select>
<label id="subjectLabel">Mati√®re :</label>
<select id="subjectSelect">
<option>Maths</option><option>Physique</option><option>Chimie</option><option>Biologie</option><option>Histoire</option><option>G√©ographie</option><option>Technologie</option><option>Morale</option><option>Dessin</option>
</select>
<br>
<button id="newQuestionBtn" onclick="nextQuestion()">Nouvelle question</button>
</div>

<div class="ia-box">
<h3 id="iaTitle">üí° Pose une question √† l'IA √©ducative</h3>
<label id="langLabel">Choisir la langue :</label>
<select id="languageSelect" onchange="updateUI()">
<option value="fr">Fran√ßais</option>
<option value="en">English</option>
<option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
<option value="es">Espa√±ol</option>
</select>
<br>
<textarea id="questionInput" placeholder="√âcris ta question ici..."></textarea><br>
<button onclick="askIA()">Envoyer</button>
<button id="speakBtn" disabled>üîä Lire la r√©ponse</button>
<div id="iaResponse"></div>
</div>

<script>
// --- VARIABLES ---
let score=0;
let currentQ=null;
let userId = localStorage.getItem("userId");
if(!userId){ userId="U"+Math.floor(Math.random()*10000); localStorage.setItem("userId", userId);}
document.getElementById("userId").innerText=userId;

// --- TRADUCTIONS UI ---
const translationsUI={
fr:{title:"üìö Site √©ducatif interactif",lang:"Choisir la langue :",level:"Niveau :",subject:"Mati√®re :",newQuestion:"Nouvelle question",score:"Score",userId:"ID Utilisateur",correct:"‚úÖ Correct !",wrong:"‚ùå Faux ! La bonne r√©ponse est : ",placeholder:"Clique sur une r√©ponse pour commencer"},
en:{title:"üìö Interactive Educational Site",lang:"Select language:",level:"Level:",subject:"Subject:",newQuestion:"New Question",score:"Score",userId:"User ID",correct:"‚úÖ Correct!",wrong:"‚ùå Wrong! Correct answer: ",placeholder:"Click a choice to start"},
ar:{title:"üìö ÿßŸÑŸÖŸàŸÇÿπ ÿßŸÑÿ™ÿπŸÑŸäŸÖŸä ÿßŸÑÿ™ŸÅÿßÿπŸÑŸä",lang:"ÿßÿÆÿ™ÿ± ÿßŸÑŸÑÿ∫ÿ©:",level:"ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ:",subject:"ÿßŸÑŸÖÿßÿØÿ©:",newQuestion:"ÿ≥ÿ§ÿßŸÑ ÿ¨ÿØŸäÿØ",score:"ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ©",userId:"ŸÖÿπÿ±ŸëŸÅ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ",correct:"‚úÖ ÿµÿ≠Ÿäÿ≠!",wrong:"‚ùå ÿÆÿ∑ÿ£! ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ© ÿßŸÑÿµÿ≠Ÿäÿ≠ÿ©: ",placeholder:"ÿßÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ ÿÆŸäÿßÿ± ŸÑŸÑÿ®ÿØÿ°"},
es:{title:"üìö Sitio Educativo Interactivo",lang:"Seleccionar idioma:",level:"Nivel:",subject:"Materia:",newQuestion:"Nueva Pregunta",score:"Puntuaci√≥n",userId:"ID Usuario",correct:"‚úÖ ¬°Correcto!",wrong:"‚ùå ¬°Incorrecto! La respuesta correcta: ",placeholder:"Haz clic en una respuesta para empezar"}
};

function updateUI(){
  let lang=document.getElementById('languageSelect').value;
  document.getElementById("title").innerText=translationsUI[lang].title;
  document.getElementById("langLabel").innerText=translationsUI[lang].lang;
  document.getElementById("levelLabel").innerText=translationsUI[lang].level;
  document.getElementById("subjectLabel").innerText=translationsUI[lang].subject;
  document.getElementById("newQuestionBtn").innerText=translationsUI[lang].newQuestion;
  document.getElementById("scoreLabel").innerText=translationsUI[lang].score + " :";
  document.getElementById("userIdLabel").innerText=translationsUI[lang].userId + " :";
  document.getElementById("question").innerText=translationsUI[lang].placeholder;
}

// --- SCORE & HISTORIQUE ---
function updateScore(){document.getElementById("score").innerText=score;}
function clearHistory(){
  if(confirm("Voulez-vous vraiment vider l‚Äôhistorique ?")){
    score=0; updateScore();
    document.getElementById("question").innerText=translationsUI[document.getElementById('languageSelect').value].placeholder;
    document.getElementById("answers").innerHTML="";
    document.getElementById("iaResponse").innerHTML="";
  }
}

// --- QUIZ SIMPLE ---
function generateLocalQuestion(){
  let level=document.getElementById("levelSelect").value;
  let subject=document.getElementById("subjectSelect").value;
  let x=Math.floor(Math.random()*10),y=Math.floor(Math.random()*10);
  return {q:`${subject} (${level}): Combien font ${x}+${y}?`, options:[x+y,x+y+1,x+y-1], a:x+y};
}

function nextQuestion(){
  currentQ=generateLocalQuestion();
  document.getElementById("question").innerText=currentQ.q;
  let ansDiv=document.getElementById("answers");
  ansDiv.innerHTML="";
  for(let opt of currentQ.options){
    let btn=document.createElement("button");
    btn.textContent=opt;
    btn.onclick=()=>checkAnswer(opt);
    ansDiv.appendChild(btn);
  }
}

// --- CHECK REPONSE + EXPLICATION IA ---
const speakBtn=document.getElementById("speakBtn");
const resultEl=document.getElementById("iaResponse");

async function checkAnswer(choice){
  const level=document.getElementById("levelSelect").value;
  const subject=document.getElementById("subjectSelect").value;
  const lang=document.getElementById('languageSelect').value;

  if(choice==currentQ.a){
    score++; updateScore();
    alert(translationsUI[lang].correct);
  } else {
    alert(translationsUI[lang].wrong + currentQ.a);
    resultEl.innerHTML="‚è≥ L‚ÄôIA explique...";
    speakBtn.disabled=true;
    try{
      const res=await fetch("/api/generate",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({
          question:`Explique pourquoi la r√©ponse √† "${currentQ.q}" est ${currentQ.a}`,
          level, subject
        })
      });
      const data=await res.json();
      resultEl.innerHTML="<b>Explication IA :</b> "+(data.answer||"‚ö†Ô∏è L‚ÄôIA ne r√©pond pas.");
      speakBtn.disabled=false;
    }catch(err){
      resultEl.innerHTML="‚ö†Ô∏è L‚ÄôIA ne r√©pond pas.";
    }
  }
}

// --- IA EDUCATIVE ---
async function askIA(){
  const question=document.getElementById("questionInput").value;
  if(!question) return alert("√âcris une question !");
  const level=document.getElementById("levelSelect").value;
  const subject=document.getElementById("subjectSelect").value;

  resultEl.innerHTML="‚è≥ L‚ÄôIA r√©fl√©chit...";
  speakBtn.disabled=true;
  try{
    const res=await fetch("/api/generate",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({question, level, subject})});
    const data=await res.json();
    resultEl.innerHTML="<b>R√©ponse :</b> "+(data.answer||"‚ö†Ô∏è L‚ÄôIA ne r√©pond pas.");
    speakBtn.disabled=false;
  }catch(err){
    resultEl.innerHTML="‚ö†Ô∏è L‚ÄôIA ne r√©pond pas.";
  }
}

// --- LECTURE VOCALE ---
speakBtn.addEventListener("click", ()=>{
  window.speechSynthesis.cancel();
  const utter=new SpeechSynthesisUtterance(resultEl.textContent);
  const langCode=document.getElementById('languageSelect').value;
  // D√©finir la langue pour la synth√®se vocale
  if(langCode==="fr") utter.lang="fr-FR";
  else if(langCode==="en") utter.lang="en-US";
  else if(langCode==="ar") utter.lang="ar-SA";
  else if(langCode==="es") utter.lang="es-ES";
  utter.rate=1;
  window.speechSynthesis.speak(utter);
});

// --- INIT ---
updateUI();
</script>
</body>
</html>