<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quiz √©ducatif payant</title>
<style>
body { font-family: Arial, sans-serif; margin:0; padding:20px; text-align:center; background:#1e3c72; color:#fff; }
select, button, input { padding:10px; margin:10px; border-radius:8px; border:none; font-size:16px; }
button { background:#ff9800; color:#fff; cursor:pointer; }
button:hover { background:#e68900; }
.iframe-container { position:relative; width:100%; max-width:500px; min-height:600px; padding-bottom:70%; height:0; overflow:hidden; border-radius:15px; margin:20px auto; }
.iframe-container iframe { position:absolute; top:0; left:0; width:100%; height:100%; border:none; }
#quizSection { margin-top:20px; max-width:600px; width:100%; background:rgba(0,0,0,0.3); padding:20px; border-radius:15px; display:none; }
#paymentSection { display:none; }
#countdown { font-weight:bold; margin-top:10px; color:yellow; }
#result { font-weight:bold; margin-top:10px; }
</style>
</head>
<body>

<h1>üìö Quiz √©ducatif interactif</h1>

<!-- Choix -->
<div id="setupSection">
  <h2>Choisissez vos options</h2>
  <label>Classe :</label>
  <select id="classSelect">
    <option value="CM2">CM2</option>
  </select><br>

  <label>Mati√®re :</label>
  <select id="subjectSelect">
    <option value="math">Math√©matiques</option>
    <option value="francais">Fran√ßais</option>
    <option value="sciences">Sciences</option>
    <option value="histoire">Histoire</option>
  </select><br>

  <label>Langue :</label>
  <select id="langSelect">
    <option value="fr">Fran√ßais</option>
    <option value="en">English</option>
    <option value="es">Espa√±ol</option>
    <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
  </select><br>

  <button onclick="startQuiz()">Commencer</button>
</div>

<!-- Quiz -->
<div id="quizSection">
  <h2 id="quizTitle"></h2>
  <div id="questionContainer"></div>
  <input type="text" id="answerInput" placeholder="Votre r√©ponse">
  <button onclick="submitAnswer()">R√©pondre</button>
  <p id="result"></p>
</div>

<!-- Paiement -->
<div id="paymentSection">
  <h2>‚ö†Ô∏è Acc√®s bloqu√©</h2>
  <p>Veuillez payer pour continuer. Acc√®s valable 24h.</p>
  <div class="iframe-container">
    <iframe src="https://www.my-coolpay.com/pay/ciWsFgwN"></iframe>
  </div>
  <p>Apr√®s paiement, copiez la ligne contenant <b>ID de transaction externe</b> :</p>
  <input type="text" id="paymentIDInput" placeholder="Ex : ID de transaction externe : 8a983ada-fb85-4af7-a3bc-06e281369afc">
  <button onclick="verifyPayment()">Valider le paiement</button>
  <p id="paymentMsg" style="color:red;"></p>
  <p id="countdown"></p>
</div>

<script>
// ‚Üê Nombre de questions gratuites avant paiement
let maxFreeQuestions = 2; // ‚Üê Modifie ce chiffre facilement

let currentQuestions = [];
let currentIndex = 0;
let answeredCount = 0;
let paymentValidated = false;

// Banque de questions CM2
const questionsBank = {
  CM2: {
    math: {
      fr: [
        { q: "Combien font 7 √ó 8 ?", a: "56" },
        { q: "Combien font 12 √∑ 3 ?", a: "4" },
        { q: "R√©sous : 15 + 9", a: "24" }
      ]
    },
    francais: {
      fr: [
        { q: "Quel est le synonyme de 'rapide' ?", a: "vite" },
        { q: "Compl√®te : Le chat ___ sur le mur.", a: "saute" },
        { q: "Quel est l'antonyme de 'grand' ?", a: "petit" }
      ]
    },
    sciences: {
      fr: [
        { q: "Quel gaz respirons-nous pour vivre ?", a: "oxyg√®ne" },
        { q: "Combien a-t-on de sens ?", a: "5" },
        { q: "Quelle √©toile √©claire la Terre ?", a: "soleil" }
      ]
    },
    histoire: {
      fr: [
        { q: "Qui a d√©couvert l'Am√©rique ?", a: "colomb" },
        { q: "En quelle ann√©e la R√©volution fran√ßaise a-t-elle commenc√© ?", a: "1789" },
        { q: "Quel pharaon est c√©l√®bre pour sa tombe intacte ?", a: "toutankhamon" }
      ]
    }
  }
};

// V√©rifier paiement (24h)
function checkPaymentValidity() {
  const paymentTime = localStorage.getItem("paymentTime");
  if (paymentTime) {
    const now = new Date();
    const diff = now - new Date(paymentTime);
    if (diff < 24 * 60 * 60 * 1000) {
      paymentValidated = true;
      document.getElementById("paymentSection").style.display = "none";
      return true;
    } else {
      localStorage.removeItem("paymentTime");
      localStorage.removeItem("paymentID");
    }
  }
  return false;
}

// M√©langer et choisir questions
function getRandomQuestions(arr, n=3) {
  let shuffled = arr.sort(() => 0.5 - Math.random());
  return shuffled.slice(0, n);
}

// D√©marrer quiz
function startQuiz() {
  const classe = document.getElementById("classSelect").value;
  const matiere = document.getElementById("subjectSelect").value;
  const langue = document.getElementById("langSelect").value;

  if (!questionsBank[classe] || !questionsBank[classe][matiere] || !questionsBank[classe][matiere][langue]) {
    alert("Pas de questions disponibles pour ce choix.");
    return;
  }

  currentQuestions = getRandomQuestions(questionsBank[classe][matiere][langue]);
  currentIndex = 0;
  answeredCount = 0;

  document.getElementById("quizTitle").textContent = `Quiz ${classe} - ${matiere}`;
  document.getElementById("setupSection").style.display = "none";
  document.getElementById("quizSection").style.display = "block";

  showNextQuestion();
}

// Afficher question suivante
function showNextQuestion() {
  if (currentIndex >= currentQuestions.length) {
    document.getElementById("result").textContent = "üéâ Fin du quiz de cette session.";
    return;
  }
  document.getElementById("questionContainer").innerText = currentQuestions[currentIndex].q;
  document.getElementById("answerInput").value = "";
  document.getElementById("result").innerText = "";
}

// Soumettre r√©ponse
function submitAnswer() {
  const ans = document.getElementById("answerInput").value.trim().toLowerCase();
  const correct = currentQuestions[currentIndex].a.toLowerCase();

  if (ans === correct) {
    document.getElementById("result").innerText = "‚úÖ Correct !";
  } else {
    document.getElementById("result").innerText = `‚ùå Incorrect ! R√©ponse : ${currentQuestions[currentIndex].a}`;
  }

  answeredCount++;
  currentIndex++;

  // V√©rifier si le paiement est requis
  if (!paymentValidated && answeredCount >= maxFreeQuestions) {
    document.getElementById("quizSection").style.display = "none";
    document.getElementById("paymentSection").style.display = "block";
  } else {
    setTimeout(showNextQuestion, 1000); // Passer √† la question suivante apr√®s 1s
  }
}

// V√©rifier paiement avec extraction de l'ID
function verifyPayment() {
  const msg = document.getElementById("paymentIDInput").value.trim();
  const paymentMsg = document.getElementById("paymentMsg");

  // Extraction de l'ID de transaction externe
  const match = msg.match(/ID de transaction externe\s*:\s*([a-z0-9-]+)/i);
  
  if(match) {
    const transactionID = match[1];
    paymentValidated = true;
    localStorage.setItem("paymentTime", new Date().toISOString());
    localStorage.setItem("paymentID", transactionID);
    
    document.getElementById("paymentSection").style.display = "none";
    document.getElementById("quizSection").style.display = "block";
    startCountdown();
    showNextQuestion();
    paymentMsg.textContent = "";
  } else {
    paymentValidated = false;
    paymentMsg.textContent = "‚ö†Ô∏è ID de paiement non reconnu. Copiez la ligne 'ID de transaction externe' du message MyCoolPay.";
  }
}

// Compte √† rebours 24h
function startCountdown() {
  const endTime = new Date(localStorage.getItem("paymentTime"));
  endTime.setHours(endTime.getHours() + 24);

  function updateCountdown() {
    const now = new Date();
    const diff = endTime - now;

    if (diff <= 0) {
      document.getElementById("countdown").textContent = "‚è≥ Temps expir√©, veuillez repayer.";
      localStorage.removeItem("paymentTime");
      localStorage.removeItem("paymentID");
      paymentValidated = false;
      return;
    }

    const hours = Math.floor(diff / (1000 * 60 * 60));
    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((diff % (1000 * 60)) / 1000);

    document.getElementById("countdown").textContent =
      `Temps restant : ${hours}h ${minutes}m ${seconds}s`;
    setTimeout(updateCountdown, 1000);
  }
  updateCountdown();
}

// Si paiement d√©j√† valid√©
if (checkPaymentValidity()) startCountdown();
</script>

</body>
</html>